"use strict";(self["webpackChunkfullstack_ecommerce_pojui"]=self["webpackChunkfullstack_ecommerce_pojui"]||[]).push([[703],{8285:function(t,e,s){s.d(e,{A:function(){return b}});var i=s(641),a=s(9322),l=s(2644);const r={"aria-label":"Page navigation example"},o={class:"pagination justify-content-center"},c={class:"page-item"},n=(0,i.Lk)("span",{"aria-hidden":"true"},"«",-1),u=[n],d=["onClick"],p={class:"page-item"},h=(0,i.Lk)("span",{"aria-hidden":"true"},"»",-1),g=[h];function k(t,e,s,n,h,k){return(0,i.uX)(),(0,i.CE)("nav",r,[(0,i.Lk)("ul",o,[(0,i.Lk)("li",c,[(0,i.Lk)("a",{class:"page-link",href:"#",onClick:e[0]||(e[0]=(0,a.D$)((t=>k.updatePage(s.pages.current_page-1)),["prevent"])),"aria-label":"Previous"},u)]),((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(s.pages.total_pages,(t=>((0,i.uX)(),(0,i.CE)("li",{class:(0,l.C4)(["page-item",{active:t===s.pages.current_page}]),key:t},[(0,i.Lk)("a",{class:"page-link",href:"#",onClick:(0,a.D$)((e=>k.updatePage(t)),["prevent"])},(0,l.v_)(t),9,d)],2)))),128)),(0,i.Lk)("li",p,[(0,i.Lk)("a",{class:"page-link",href:"#",onClick:e[1]||(e[1]=(0,a.D$)((t=>k.updatePage(s.pages.current_page+1)),["prevent"])),"aria-label":"Next"},g)])])])}var f={props:["pages"],methods:{updatePage(t){this.$emit("emit-pages",t)}}},m=s(6262);const v=(0,m.A)(f,[["render",k]]);var b=v},457:function(t,e,s){s.r(e),s.d(e,{default:function(){return tt}});var i=s(641),a=s(2644),l=s(9322),r=s(1888),o=s(5111),c=s(3644),n=s(2649),u=s(7278);const d={class:"products-banner"},p={key:0,class:"text-center"},h={key:1,class:"text-center"},g={class:"container"},k=(0,i.Lk)("i",{class:"loading-box"},null,-1),f={class:"row rwd-product-box"},m={class:"col-md-3 pr-md-0"},v={class:"list-group sticky-top"},b={class:"dropdown"},y=["onClick"],C={class:"col-md-9 position-relative"},L={key:0,class:"sortData-box-product"},w=(0,i.Lk)("option",{value:"",disabled:""},"商品排序",-1),T=(0,i.Lk)("option",{value:"highToLow"},"價格由高至低",-1),I=(0,i.Lk)("option",{value:"lowToHigh"},"價格由低至高",-1),_=[w,T,I],x=(0,i.Lk)("span",{class:"icon"},[(0,i.Lk)("i",{class:"fas fa-sort"})],-1),D={class:"d-flex flex-wrap m-card-ground"},F=["onClick"],X=(0,i.Lk)("i",{class:"far fa-bookmark"},null,-1),A=[X],E=["onClick"],P=(0,i.Lk)("i",{class:"fas fa-bookmark"},null,-1),U=[P],j={class:"position-relative"},H={class:"text-center card-title font-weight-bold"},V={class:"d-flex flex-column position-relative"},K={class:"text-center price-box"},O={key:0,class:"origin-price-f mr-2"},W={class:"price-color"},J=["disabled","onClick"],N=(0,i.Lk)("i",{class:"fas fa-spinner fa-spin"},null,-1),Q=["onClick"];function S(t,e,s,w,T,I){const $=(0,i.g2)("loading"),X=(0,i.g2)("router-link");return(0,i.uX)(),(0,i.CE)("div",null,[(0,i.Lk)("div",d,[""===T.filterType?((0,i.uX)(),(0,i.CE)("h2",p,"全部商品")):((0,i.uX)(),(0,i.CE)("h2",h,(0,a.v_)(T.filterType),1))]),(0,i.Lk)("div",g,[(0,i.bF)($,{active:T.isLoading},{default:(0,i.k6)((()=>[k])),_:1},8,["active"]),(0,i.Lk)("div",f,[(0,i.Lk)("nav",m,[(0,i.Lk)("ul",v,[(0,i.Lk)("div",b,[(0,i.bF)(u.d4,{class:"select",modelValue:T.filterType,"onUpdate:modelValue":e[0]||(e[0]=t=>T.filterType=t),label:"商品分類",items:T.category},{default:(0,i.k6)((()=>[(0,i.bF)(n.q,null,{default:(0,i.k6)((()=>[(0,i.bF)(r.x8,null,{default:(0,i.k6)((()=>[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(T.category,(t=>((0,i.uX)(),(0,i.Wv)(o.g,{key:t},{default:(0,i.k6)((()=>[(0,i.bF)(c.U,{onClick:(0,l.D$)((e=>T.filterType=t),["prevent"])},{default:(0,i.k6)((()=>[(0,i.eW)((0,a.v_)(t),1)])),_:2},1032,["onClick"])])),_:2},1024)))),128))])),_:1})])),_:1})])),_:1},8,["modelValue","items"])]),T.products!==[]?((0,i.uX)(!0),(0,i.CE)(i.FK,{key:0},(0,i.pI)(T.category,(t=>((0,i.uX)(),(0,i.CE)("li",{class:"list-group-item p-xy-0 des-list-group",key:t},[(0,i.Lk)("a",{"data-toggle":"tab",href:"#",class:(0,a.C4)(["list-btn",{active:t===T.filterType}]),onClick:(0,l.D$)((e=>T.filterType=t),["prevent"])},(0,a.v_)(t),11,y)])))),128)):(0,i.Q3)("",!0)])]),(0,i.Lk)("div",C,[T.products!==[]?((0,i.uX)(),(0,i.CE)("div",L,[(0,i.Lk)("span",null,(0,a.v_)(I.getFilter.length)+" 個商品",1),(0,i.bo)((0,i.Lk)("select",{name:"sortData",id:"sortData","onUpdate:modelValue":e[1]||(e[1]=t=>T.sortData=t),class:"form-control sortData-product mb-3",onChange:e[2]||(e[2]=t=>I.sortProducts())},_,544),[[l.u1,T.sortData]]),x])):(0,i.Q3)("",!0),(0,i.Lk)("div",D,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(I.getFilter,(e=>((0,i.uX)(),(0,i.CE)("div",{class:"card-flex shadow-sm",key:e.id},[(0,i.Lk)("div",{class:"item-img",style:(0,a.Tr)({backgroundImage:`url(${e.imageUrl})`})},[(0,i.bF)(X,{to:`/product/${e.id}`,class:"btn card-btn-box btn-sm"},{default:(0,i.k6)((()=>[(0,i.eW)(" 查看更多 ")])),_:2},1032,["to"]),-1===T.followData.indexOf(e.id)?((0,i.uX)(),(0,i.CE)("div",{key:0,title:"收藏",class:"icon-tags",onClick:(0,l.D$)((t=>I.addFollow(e.id)),["prevent"])},A,8,F)):((0,i.uX)(),(0,i.CE)("div",{key:1,title:"收藏",class:"icon-tags",onClick:(0,l.D$)((t=>I.addFollow(e.id)),["prevent"])},U,8,E))],4),(0,i.Lk)("div",j,[(0,i.Lk)("h5",H,(0,a.v_)(e.title),1)]),(0,i.Lk)("div",V,[(0,i.Lk)("div",K,[0!==e.origin_price?((0,i.uX)(),(0,i.CE)("span",O,(0,a.v_)(t.$filters.currency(e.origin_price)),1)):(0,i.Q3)("",!0),(0,i.Lk)("span",W,(0,a.v_)(t.$filters.currency(e.price)),1)]),T.status.loadingItem===e.id?((0,i.uX)(),(0,i.CE)("button",{key:0,class:"btn btn-shopping btn-sm",type:"button",disabled:T.status.loadingItem===e.id,onClick:t=>I.addToCart(e.id)},[N,(0,i.eW)(" 加到購物車 ")],8,J)):((0,i.uX)(),(0,i.CE)("button",{key:1,class:"btn btn-shopping btn-sm",type:"button",onClick:t=>I.addToCart(e.id)}," 加到購物車 ",8,Q))])])))),128))])])])])])}var Z=s(2541),q=s(8285),z=s(8965),B=s(1601),G=s(1884),M={data(){return{isLoading:!1,status:{loadingItem:""},category:["全部商品","香氛蠟燭","擴香","精油","其他"],isActive:!1,filterType:"",products:[],sortData:"",followData:[],pagination:{},carts:{},userCartItems:[],uid:null}},components:{Pagination:q.A},created(){this.getAuthState(),this.getProducts(),this.category.length>0&&(this.filterType=this.category[0])},methods:{getAuthState(){(0,B.hg)(z.j2,(t=>{t&&t.emailVerified&&(this.uid=t.uid,this.updateUserCartItem())}))},async updateUserCartItem(t){const e=(0,G.rJ)(z.db,"userInfo"),s=(0,G.H9)(e,this.uid),i=await(0,G.x7)(s);if(i.exists()){if(this.userCartItems=i.data().cartItem,void 0!==t){const e=this.userCartItems.findIndex((e=>e.product.id===t.product.id));-1!==e&&this.userCartItems.splice(e,1),this.userCartItems.push(t),await(0,G.mZ)(s,{cartItem:this.userCartItems})}}else console.log("No such document!")},getProducts(){const t="https://fullstack-ecommerce-pojui-backend-vercel.vercel.app/products/all";this.isLoading=!0,setTimeout((()=>{this.$http.get(t).then((t=>{this.products=t.data.products,null!==this.uid&&this.getFollow();const{categoryName:e}=this.$route.params;e&&(this.filterType=e),this.isLoading=!1})).catch((()=>{Z.A.fire({title:"資料讀取失敗，請稍後再試",icon:"error"}),this.isLoading=!1}))}),1e3)},async getFollow(){const t=(0,G.rJ)(z.db,"userInfo"),e=(0,G.H9)(t,this.uid),s=await(0,G.x7)(e);s.exists()&&(this.followData=s.data().favorite)},scrollTitle(){""===this.filterType||"熱門商品"===this.filterType?this.isActive=!1:this.isActive=!0,$("html,body").animate({scrollTop:0},0)},sortProducts(){this.products.sort(((t,e)=>"lowToHigh"===this.sortData?t.price-e.price:"highToLow"===this.sortData?e.price-t.price:this.products))},addToCart(t){if(null!==this.uid){this.status.loadingItem=t;const e=`https://fullstack-ecommerce-pojui-backend-vercel.vercel.app/cart/${this.uid}/add`,s={product_id:t,qty:1};this.$http.post(e,{data:s}).then((t=>{this.updateUserCartItem(t.data.data),setTimeout((()=>{this.status.loadingItem="",this.$emitter.emit("update-total",this.uid),Z.A.fire({title:"已加入購物車",icon:"success"})}),500)})).catch((t=>{this.status.loadingItem="",Z.A.fire({title:`${t.response.data.errors}`,icon:"warning"})}))}else Z.A.fire({title:"請先登入會員",icon:"warning"}),this.$router.push("/userlogin")},async addFollow(t){if(null!==this.uid){const e=this.followData.indexOf(t),s=(0,G.rJ)(z.db,"userInfo"),i=(0,G.H9)(s,this.uid);-1===e?(this.followData.push(t),await(0,G.mZ)(i,{favorite:this.followData}),Z.A.fire({title:"已加入收藏",icon:"success"})):(this.followData.splice(e,1),await(0,G.mZ)(i,{favorite:this.followData}),Z.A.fire({title:"已取消收藏",icon:"success"}))}else Z.A.fire({title:"請先登入會員",icon:"warning"}),this.$router.push("/userlogin")}},computed:{getFilter(){let t=[];switch(this.filterType){case"香氛蠟燭":t=this.products.filter((t=>"Fragrance"==t.category)),this.scrollTitle();break;case"擴香":t=this.products.filter((t=>"AromaStickDiffuser"==t.category)),this.scrollTitle();break;case"精油":t=this.products.filter((t=>"FragranceOil"===t.category)),this.scrollTitle();break;case"其他":t=this.products.filter((t=>"Other"===t.category)),this.scrollTitle();break;default:t=this.products,this.scrollTitle();break}return t}}},R=s(6262);const Y=(0,R.A)(M,[["render",S]]);var tt=Y}}]);
//# sourceMappingURL=703.d8bbe730.js.map